<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Johnny Jumper: Fixed & Guaranteed</title>
    <style>
        body { margin: 0; overflow: hidden; background: #2c1b0e; font-family: 'Arial Black', sans-serif; color: #f0d9b5; }
        canvas { display: block; background: linear-gradient(#87CEEB, #e0f6ff); margin: auto; border: 5px solid #5d4037; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; font-size: 24px; text-shadow: 2px 2px #000; }
        .menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                background: #5d4037; padding: 30px; border: 4px solid #f0d9b5; text-align: center; box-shadow: 0 0 50px #000; z-index: 100; }
        button { background: #d2b48c; border: none; padding: 15px 30px; font-weight: bold; cursor: pointer; border-bottom: 4px solid #8d6e63; font-size: 18px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="ui">Level: <span id="lvl-txt">1</span> | Tode: <span id="death-txt">0</span></div>

<div id="main-menu" class="menu">
    <h1>ðŸ¤  JOHNNY JUMPER ðŸ¤ </h1>
    <p>VERSION 2026: 100% SCHAFFBARE SPRÃœNGE</p>
    <button onclick="startGame()">MISSION STARTEN</button>
</div>

<div id="game-over" class="menu hidden">
    <h1 style="color: #ff4444;">ABGEWORFEN!</h1>
    <button onclick="restartLevel()">NOCHMAL VERSUCHEN</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = 1000;
canvas.height = 500;

// Physik-Werte fÃ¼r Johnny
const GRAVITY = 0.65;
const FRICTION = 0.8;
const JUMP_FORCE = -16; 
const SPEED = 8;

let currentLevel = 1;
let deaths = 0;
let gameState = 'MENU';
let keys = {};
let cameraX = 0;

let player = { x: 100, y: 100, w: 35, h: 50, vx: 0, vy: 0, grounded: false };
let platforms = [];
let entities = [];

function setupLevel(lvl) {
    platforms = [];
    entities = [];
    cameraX = 0;
    player.x = 50;
    player.y = 200;
    player.vx = 0;
    player.vy = 0;

    // Start-Plattform (groÃŸ und sicher)
    let lastP = { x: 0, y: 350, w: 300, h: 150, type: 'normal' };
    platforms.push(lastP);

    let levelLength = 10 + lvl;
    for (let i = 0; i < levelLength; i++) {
        /* 
           MATHEMATISCHE GARANTIE:
           Johnny springt ca. 180px hoch und kann dabei ca. 350px weit gleiten.
           Wir setzen die LÃ¼cken auf maximal 220px, damit man sie IMMER schafft.
        */
        let gapX = 80 + Math.random() * 140; // Max 220px LÃ¼cke
        let diffY = (Math.random() * 100) - 50; // Max 50px HÃ¶henunterschied
        
        let newX = lastP.x + lastP.w + gapX;
        let newY = lastP.y + diffY;

        // Sicherheitscheck: Nicht aus dem Bild generieren
        if (newY < 150) newY = 150;
        if (newY > 400) newY = 400;

        let pWidth = 120 + Math.random() * 100;
        let type = 'normal';
        let r = Math.random();
        
        if (r > 0.92) type = 'trampoline';
        else if (r > 0.85) type = 'moving';
        else if (r > 0.75) type = 'falling';

        lastP = { x: newX, y: newY, w: pWidth, h: 30, type: type };
        platforms.push(lastP);
        
        // Kanonen nur wenn genug Platz ist
        if (lvl > 2 && Math.random() > 0.8 && pWidth > 150) {
            entities.push({ x: lastP.x + 50, y: lastP.y - 35, type: 'cannon', timer: 0 });
        }
    }

    // Ziel (GroÃŸer Saloon)
    platforms.push({ x: lastP.x + lastP.w + 120, y: 250, w: 250, h: 250, type: 'goal' });
}

function update() {
    if (gameState !== 'PLAY') return;

    // Steuerung
    if (keys['ArrowRight'] || keys['KeyD']) player.vx += 1.2;
    if (keys['ArrowLeft'] || keys['KeyA']) player.vx -= 1.2;
    
    player.vx *= FRICTION;
    player.vy += GRAVITY;

    // Kollisions-Vorhersage (Verhindert das Durchfallen)
    let nextY = player.y + player.vy;
    player.grounded = false;

    for (let p of platforms) {
        // Horizontale Ãœbereinstimmung
        if (player.x + player.w > p.x && player.x < p.x + p.w) {
            // Check ob Johnny auf der Plattform landet
            if (player.vy >= 0 && player.y + player.h <= p.y + 10 && nextY + player.h >= p.y) {
                player.vy = 0;
                nextY = p.y - player.h;
                player.grounded = true;

                if (p.type === 'goal') nextLevel();
                if (p.type === 'trampoline') player.vy = JUMP_FORCE * 1.5;
                if (p.type === 'falling') p.y += 12;
            }
        }
    }

    player.x += player.vx;
    player.y = nextY;

    if (player.y > canvas.height + 200) die();
    cameraX = player.x - 200; // Johnny bleibt links im Fokus

    // Plattform-Bewegung
    platforms.forEach(p => { if (p.type === 'moving') p.y += Math.sin(Date.now() / 400) * 3; });

    // Projektile
    entities.forEach((e, i) => {
        if (e.type === 'cannon') {
            e.timer++;
            if (e.timer > 90) {
                entities.push({ x: e.x, y: e.y + 10, vx: -6, type: 'bullet' });
                e.timer = 0;
            }
        }
        if (e.type === 'bullet') {
            e.x += e.vx;
            if (player.x < e.x + 10 && player.x + player.w > e.x && player.y < e.y + 10 && player.y + player.h > e.y) die();
            if (e.x < cameraX - 100) entities.splice(i, 1);
        }
    });

    if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.grounded) {
        player.vy = JUMP_FORCE;
        player.grounded = false;
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-cameraX, 0);

    platforms.forEach(p => {
        if (p.type === 'normal') ctx.fillStyle = '#5d4037';
        else if (p.type === 'trampoline') ctx.fillStyle = '#ff00ff';
        else if (p.type === 'moving') ctx.fillStyle = '#3498db';
        else if (p.type === 'falling') ctx.fillStyle = '#e67e22';
        else if (p.type === 'goal') ctx.fillStyle = '#27ae60';
        
        ctx.fillRect(p.x, p.y, p.w, p.h);
        if (p.type === 'goal') {
            ctx.fillStyle = '#fff';
            ctx.font = "bold 24px Arial";
            ctx.fillText("SALOON", p.x + 70, p.y + 60);
        }
    });

    entities.forEach(e => {
        if (e.type === 'cannon') { ctx.fillStyle = '#333'; ctx.fillRect(e.x, e.y, 40, 25); }
        if (e.type === 'bullet') { ctx.fillStyle = '#ff0000'; ctx.beginPath(); ctx.arc(e.x, e.y, 8, 0, Math.PI*2); ctx.fill(); }
    });

    // Johnny
    ctx.fillStyle = '#f1c40f';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = '#5d4037'; // Hut
    ctx.fillRect(player.x - 5, player.y, player.w + 10, 10);
    ctx.fillRect(player.x + 5, player.y - 10, player.w - 10, 10);

    ctx.restore();
}

function die() {
    deaths++;
    gameState = 'OVER';
    document.getElementById('game-over').classList.remove('hidden');
    document.getElementById('death-txt').innerText = deaths;
}

function nextLevel() {
    currentLevel++;
    document.getElementById('lvl-txt').innerText = currentLevel;
    setupLevel(currentLevel);
}

function startGame() {
    document.getElementById('main-menu').classList.add('hidden');
    gameState = 'PLAY';
    setupLevel(currentLevel);
    requestAnimationFrame(gameLoop);
}

function restartLevel() {
    document.getElementById('game-over').classList.add('hidden');
    setupLevel(currentLevel);
    gameState = 'PLAY';
}

function gameLoop() {
    update();
    draw();
    if (gameState === 'PLAY' || gameState === 'OVER') requestAnimationFrame(gameLoop);
}

window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

</script>
</body>
</html>
