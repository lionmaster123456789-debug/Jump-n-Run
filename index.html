<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Johnny Jumper: Cowboy Adventure</title>
    <style>
        body { margin: 0; overflow: hidden; background: #332211; font-family: 'Courier New', Courier, monospace; color: #f0d9b5; }
        canvas { display: block; background: #87CEEB; margin: auto; border: 4px solid #5d4037; }
        #ui { position: absolute; top: 10px; left: 10px; pointer-events: none; }
        .menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                background: rgba(93, 64, 55, 0.95); padding: 30px; border: 4px solid #f0d9b5; text-align: center; }
        button { background: #8d6e63; border: 2px solid #f0d9b5; color: white; padding: 10px 20px; cursor: pointer; margin: 5px; }
        .hidden { display: none; }
        .skin-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 10px; }
    </style>
</head>
<body>

<div id="ui">
    <div id="stats">Level: 1 | Tode: 0</div>
</div>

<div id="main-menu" class="menu">
    <h1>ðŸ¤  JOHNNY JUMPER ðŸ¤ </h1>
    <p>Hilf Johnny durch 50 WÃ¼sten-Level!</p>
    <button onclick="startGame()">MISSION STARTEN</button>
    <button onclick="showSkins()">GARDEROBE (SKINS)</button>
</div>

<div id="skin-menu" class="menu hidden">
    <h2>WÃ¤hle deinen Cowboy</h2>
    <div class="skin-grid" id="skin-list"></div>
    <button onclick="hideSkins()">ZURÃœCK</button>
</div>

<div id="game-over" class="menu hidden">
    <h1 id="over-title">GESTORBEN!</h1>
    <button onclick="restartLevel()">ERNEUT VERSUCHEN</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Spiel-Konstanten
canvas.width = 800;
canvas.height = 400;
const GRAVITY = 0.5;
const FRICTION = 0.8;

let currentLevel = 1;
let deaths = 0;
let gameState = 'MENU';
let keys = {};

// Johnny (Spieler)
let player = {
    x: 50, y: 300, w: 30, h: 45,
    vx: 0, vy: 0,
    jumpPower: -12,
    speed: 5,
    grounded: false,
    color: '#ffcc00',
    hatColor: '#5d4037',
    shape: 'rect'
};

// Skins (20 StÃ¼ck)
const skins = [];
for(let i=0; i<20; i++) {
    skins.push({
        id: i,
        name: "Skin " + (i+1),
        color: `hsl(${i * 18}, 70%, 50%)`,
        hat: `hsl(${i * 18}, 40%, 20%)`,
        shape: i % 3 === 0 ? 'round' : 'rect'
    });
}

// Level-Objekte
let platforms = [];
let hazards = []; // Lava & Stacheln
let cannons = [];
let projectiles = [];
let goal = { x: 0, y: 0, w: 40, h: 60 };

function setupLevel(lvl) {
    platforms = [];
    hazards = [];
    cannons = [];
    projectiles = [];
    
    // Boden
    platforms.push({ x: 0, y: 380, w: 2000, h: 20, type: 'ground' });

    // Prozedurale Level-Logik fÃ¼r 50 Level
    let seed = lvl * 1337;
    function random() {
        seed = (seed * 9301 + 49297) % 233280;
        return seed / 233280;
    }

    let lastX = 150;
    for(let i=0; i < 5 + lvl; i++) {
        let gap = 80 + random() * 100;
        let width = 100 + random() * 100;
        let height = 300 - random() * 150;
        
        platforms.push({ x: lastX, y: height, w: width, h: 20 });
        
        // FÃ¼ge Gefahren hinzu ab Level 2
        if(lvl > 1 && random() > 0.6) {
            hazards.push({ x: lastX + 20, y: height - 10, w: 30, h: 10, type: 'spike' });
        }
        
        // Lava am Boden
        if(lvl > 5 && random() > 0.7) {
            hazards.push({ x: lastX - 50, y: 380, w: 60, h: 20, type: 'lava' });
        }

        // Kanonen ab Level 10
        if(lvl > 10 && i % 4 === 0) {
            cannons.push({ x: lastX + 10, y: height - 40, lastShot: 0 });
        }

        lastX += width + gap;
    }

    goal.x = lastX;
    goal.y = 250;
    
    player.x = 50;
    player.y = 300;
    player.vx = 0;
    player.vy = 0;
}

function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.shadowBlur = 10;
    ctx.shadowColor = 'rgba(0,0,0,0.3)';

    if(player.shape === 'round') {
        ctx.beginPath();
        ctx.arc(player.x + player.w/2, player.y + player.h/2, player.w/2, 0, Math.PI*2);
        ctx.fill();
    } else {
        ctx.fillRect(player.x, player.y, player.w, player.h);
    }
    
    // Cowboyhut
    ctx.fillStyle = player.hatColor;
    ctx.fillRect(player.x - 5, player.y, player.w + 10, 8);
    ctx.fillRect(player.x + 5, player.y - 12, player.w - 10, 15);
    ctx.shadowBlur = 0;
}

function update() {
    if(gameState !== 'PLAY') return;

    if(keys['ArrowRight'] || keys['KeyD']) player.vx < player.speed && player.vx++;
    if(keys['ArrowLeft'] || keys['KeyA']) player.vx > -player.speed && player.vx--;
    
    player.vx *= FRICTION;
    player.vy += GRAVITY;
    
    player.x += player.vx;
    player.y += player.vy;
    player.grounded = false;

    // Kollision mit Plattformen
    platforms.forEach(p => {
        if(player.x < p.x + p.w && player.x + player.w > p.x &&
           player.y + player.h > p.y && player.y + player.h < p.y + p.vy + 10) {
            player.grounded = true;
            player.vy = 0;
            player.y = p.y - player.h;
        }
    });

    if((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.grounded) {
        player.vy = player.jumpPower;
        player.grounded = false;
    }

    // Gefahren & Kanonen Logik
    hazards.forEach(h => {
        if(player.x < h.x + h.w && player.x + player.w > h.x && player.y < h.y + h.h && player.y + player.h > h.y) {
            die();
        }
    });

    cannons.forEach(c => {
        if(Date.now() - c.lastShot > 2000) {
            projectiles.push({ x: c.x, y: c.y + 10, vx: -4 });
            c.lastShot = Date.now();
        }
    });

    projectiles.forEach((p, i) => {
        p.x += p.vx;
        if(player.x < p.x + 10 && player.x + player.w > p.x && player.y < p.y + 10 && player.y + player.h > p.y) {
            die();
        }
        if(p.x < -100) projectiles.splice(i, 1);
    });

    // Ziel erreicht
    if(player.x < goal.x + goal.w && player.x + player.w > goal.x && player.y < goal.y + goal.h && player.y + player.h > goal.y) {
        nextLevel();
    }

    // Aus dem Level gefallen
    if(player.y > canvas.height) die();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // WÃ¼stenhintergrund (Berge)
    ctx.fillStyle = '#d2b48c';
    ctx.beginPath();
    ctx.moveTo(0, 400); ctx.lineTo(200, 150); ctx.lineTo(400, 400);
    ctx.moveTo(300, 400); ctx.lineTo(600, 100); ctx.lineTo(900, 400);
    ctx.fill();

    // Kamera-Verschiebung (Johnny folgen)
    ctx.save();
    ctx.translate(-player.x + 100, 0);

    // Plattformen
    platforms.forEach(p => {
        ctx.fillStyle = p.type === 'ground' ? '#3e2723' : '#5d4037';
        ctx.fillRect(p.x, p.y, p.w, p.h);
    });

    // Gefahren
    hazards.forEach(h => {
        ctx.fillStyle = h.type === 'spike' ? '#999' : '#ff4400';
        ctx.fillRect(h.x, h.y, h.w, h.h);
    });

    // Kanonen & Projektile
    ctx.fillStyle = '#333';
    cannons.forEach(c => ctx.fillRect(c.x, c.y, 30, 30));
    projectiles.forEach(p => {
        ctx.beginPath(); ctx.arc(p.x, p.y, 5, 0, Math.PI*2); ctx.fill();
    });

    // Ziel (Saloon-TÃ¼r)
    ctx.fillStyle = '#221100';
    ctx.fillRect(goal.x, goal.y, goal.w, goal.h);
    ctx.fillStyle = '#f0d9b5';
    ctx.fillText("SALOON", goal.x, goal.y - 10);

    drawPlayer();
    ctx.restore();
}

function die() {
    deaths++;
    gameState = 'OVER';
    document.getElementById('game-over').classList.remove('hidden');
    updateHUD();
}

function nextLevel() {
    currentLevel++;
    if(currentLevel > 50) {
        alert("GEWONNEN! Du bist der schnellste Cowboy!");
        currentLevel = 1;
    }
    setupLevel(currentLevel);
    updateHUD();
}

function updateHUD() {
    document.getElementById('stats').innerText = `Level: ${currentLevel} | Tode: ${deaths}`;
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

// MenÃ¼-Steuerung
function startGame() {
    document.getElementById('main-menu').classList.add('hidden');
    gameState = 'PLAY';
    currentLevel = 1;
    setupLevel(currentLevel);
}

function restartLevel() {
    document.getElementById('game-over').classList.add('hidden');
    setupLevel(currentLevel);
    gameState = 'PLAY';
}

function showSkins() {
    document.getElementById('main-menu').classList.add('hidden');
    document.getElementById('skin-menu').classList.remove('hidden');
    const list = document.getElementById('skin-list');
    list.innerHTML = '';
    skins.forEach(s => {
        const btn = document.createElement('button');
        btn.style.backgroundColor = s.color;
        btn.innerText = s.name;
        btn.onclick = () => {
            player.color = s.color;
            player.hatColor = s.hat;
            player.shape = s.shape;
        };
        list.appendChild(btn);
    });
}

function hideSkins() {
    document.getElementById('skin-menu').classList.add('hidden');
    document.getElementById('main-menu').classList.remove('hidden');
}

window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

gameLoop();
</script>
</body>
</html>
